<!DOCTYPE html>
<html lang="pt-br" class="scroll-smooth">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elite Construction | AI-Powered Engineering</title>
    <!-- Import Map to resolve bare module specifiers in vanilla JS -->
    <script type="importmap">
    {
      "imports": {
        "@google/genai": "https://esm.sh/@google/genai"
      }
    }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,700;1,700&display=swap"
        rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .font-serif {
            font-family: 'Playfair Display', serif;
        }

        .bg-gold {
            background-color: #D97706;
        }

        .text-gold {
            color: #D97706;
        }

        .border-gold {
            border-color: #D97706;
        }

        /* Custom Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fade-in {
            animation: fadeIn 0.8s ease-out forwards;
        }

        .glass-header {
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(12px);
        }

        .chat-container::-webkit-scrollbar {
            width: 4px;
        }

        .chat-container::-webkit-scrollbar-thumb {
            background: #d97706;
            border-radius: 10px;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-900 overflow-x-hidden">

    <!-- Header -->
    <header id="header" class="fixed top-0 left-0 w-full z-50 transition-all duration-300 py-6 bg-transparent">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <a href="#inicio" class="flex items-center gap-3">
                <div class="bg-amber-600 p-2 rounded-lg">
                    <i data-lucide="building-2" class="text-white w-6 h-6"></i>
                </div>
                <span class="text-white text-2xl font-bold tracking-tighter">
                    ELITE <span class="text-amber-500 font-serif italic font-normal">Construction</span>
                </span>
            </a>

            <nav class="hidden md:flex items-center gap-8 text-white font-medium">
                <a href="#inicio"
                    class="hover:text-amber-500 transition-colors uppercase text-xs tracking-widest">Início</a>
                <a href="#sobre"
                    class="hover:text-amber-500 transition-colors uppercase text-xs tracking-widest">Sobre</a>
                <a href="#servicos"
                    class="hover:text-amber-500 transition-colors uppercase text-xs tracking-widest">Serviços</a>
                <a href="#projetos"
                    class="hover:text-amber-500 transition-colors uppercase text-xs tracking-widest">Projetos</a>
                <a href="#contato"
                    class="bg-amber-600 px-6 py-2.5 rounded-lg hover:bg-amber-700 transition-all font-bold shadow-lg shadow-amber-600/20">ORÇAMENTO</a>
            </nav>

            <button class="md:hidden text-white" onclick="toggleMobileMenu(true)">
                <i data-lucide="menu" class="w-6 h-6"></i>
            </button>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div id="mobile-menu" class="fixed inset-0 z-[60] bg-slate-900 hidden flex-col items-center justify-center gap-8">
        <button class="absolute top-8 right-8 text-white" onclick="toggleMobileMenu(false)">
            <i data-lucide="x" class="w-8 h-8"></i>
        </button>
        <a href="#inicio" class="text-3xl text-white font-serif hover:text-amber-500"
            onclick="toggleMobileMenu(false)">Início</a>
        <a href="#sobre" class="text-3xl text-white font-serif hover:text-amber-500"
            onclick="toggleMobileMenu(false)">Sobre</a>
        <a href="#servicos" class="text-3xl text-white font-serif hover:text-amber-500"
            onclick="toggleMobileMenu(false)">Serviços</a>
        <a href="#projetos" class="text-3xl text-white font-serif hover:text-amber-500"
            onclick="toggleMobileMenu(false)">Projetos</a>
        <a href="#contato" class="text-3xl text-white font-serif hover:text-amber-500"
            onclick="toggleMobileMenu(false)">Contato</a>
    </div>

    <!-- Hero Section -->
    <section id="inicio" class="relative h-screen flex items-center justify-center overflow-hidden">
        <div class="absolute inset-0">
            <img src="https://images.unsplash.com/photo-1486406146926-c627a92ad1ab?auto=format&fit=crop&q=80&w=2070"
                class="w-full h-full object-cover scale-105" alt="Elite Background">
            <div class="absolute inset-0 bg-gradient-to-r from-slate-900/90 via-slate-900/60 to-transparent"></div>
        </div>
        <div class="container mx-auto px-6 relative z-10">
            <div class="max-w-3xl animate-fade-in">
                <h4 class="text-amber-500 font-bold uppercase tracking-[0.4em] mb-4 text-sm">Engenharia de Valor</h4>
                <h1 class="text-white text-6xl md:text-8xl font-serif leading-tight mb-8">
                    Arquitetando o seu <span class="text-amber-500 italic">legado</span>.
                </h1>
                <p class="text-slate-300 text-xl mb-10 leading-relaxed max-w-xl">
                    Referência em obras de alto padrão. Integramos inteligência artificial ao processo construtivo para
                    garantir perfeição em cada detalhe.
                </p>
                <div class="flex flex-col sm:flex-row gap-4">
                    <a href="#projetos"
                        class="px-10 py-5 bg-amber-600 text-white font-bold rounded-xl shadow-2xl hover:bg-amber-700 transition-all flex items-center justify-center gap-2">
                        Explorar Portfólio <i data-lucide="arrow-right" class="w-5 h-5"></i>
                    </a>
                    <a href="#sobre"
                        class="px-10 py-5 border-2 border-white/30 text-white font-bold rounded-xl hover:bg-white hover:text-slate-900 transition-all backdrop-blur-sm">
                        Nossa História
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- Stats -->
    <section class="bg-slate-900 py-16 border-y border-slate-800">
        <div class="container mx-auto px-6 grid grid-cols-2 md:grid-cols-4 gap-12 text-center">
            <div>
                <h3 class="text-amber-500 text-5xl font-bold mb-2 font-serif">25+</h3>
                <p class="text-slate-500 uppercase text-xs tracking-widest font-bold">Anos de Mercado</p>
            </div>
            <div>
                <h3 class="text-amber-500 text-5xl font-bold mb-2 font-serif">150+</h3>
                <p class="text-slate-500 uppercase text-xs tracking-widest font-bold">Obras Entregues</p>
            </div>
            <div>
                <h3 class="text-amber-500 text-5xl font-bold mb-2 font-serif">12k</h3>
                <p class="text-slate-500 uppercase text-xs tracking-widest font-bold">m² Construídos</p>
            </div>
            <div>
                <h3 class="text-amber-500 text-5xl font-bold mb-2 font-serif">100%</h3>
                <p class="text-slate-500 uppercase text-xs tracking-widest font-bold">Satisfação</p>
            </div>
        </div>
    </section>

    <!-- About Section (Image on Left) -->
    <section id="sobre" class="py-24 bg-white overflow-hidden">
        <div class="container mx-auto px-6">
            <div class="flex flex-col lg:flex-row items-center gap-20">
                <div class="lg:w-1/2 relative order-2 lg:order-1">
                    <div class="absolute -top-10 -left-10 w-40 h-40 border-t-8 border-l-8 border-amber-500/20"></div>
                    <img src="/imgs/depositphotos_203567962-stock-photo-professional-engineers-safety-vests-hardhats.jpg"
                        class="rounded-3xl shadow-2xl relative z-10 object-cover w-full h-[450px]" alt="Elite Team">
                    <!-- Overlapping Decorative Image on the Left side -->
                    <div class="absolute -bottom-10 -left-10 w-64 h-64 hidden xl:block z-20">
                        <img src="/imgs/engenheiro-civil-trabalhador-da-construcao-civil-e-arquitetos-usando-capacetes-e-coletes-de-seguranca-estao-trabalhando-juntos-no-canteiro-de-obras-constr.avif"
                            class="rounded-2xl shadow-2xl border-4 border-white object-cover w-full h-full"
                            alt="Detail">
                    </div>
                    <div class="absolute -bottom-8 -right-8 bg-slate-900 p-8 rounded-2xl shadow-xl z-20">
                        <p class="text-white text-4xl font-serif italic text-amber-500">Elite</p>
                        <p class="text-slate-400 text-xs tracking-[0.3em] uppercase mt-2">Fundada em 1998</p>
                    </div>
                </div>
                <div class="lg:w-1/2 order-1 lg:order-2">
                    <h2 class="text-amber-600 font-bold uppercase tracking-widest mb-4">A Construtora</h2>
                    <h3 class="text-5xl font-serif text-slate-900 mb-8 leading-tight">Excelência que atravessa gerações.
                    </h3>
                    <p class="text-slate-600 text-lg mb-8 leading-relaxed">
                        A Elite Construction nasceu do desejo de elevar o patamar da engenharia brasileira. Hoje, unimos
                        décadas de experiência técnica com as mais recentes inovações em Inteligência Artificial e
                        sustentabilidade.
                    </p>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 mb-10">
                        <div class="flex items-center gap-3"><i data-lucide="check-circle-2"
                                class="text-amber-600 w-5 h-5"></i><span class="font-bold text-slate-800">Certificação
                                ISO 9001</span></div>
                        <div class="flex items-center gap-3"><i data-lucide="check-circle-2"
                                class="text-amber-600 w-5 h-5"></i><span class="font-bold text-slate-800">Tecnologia
                                BIM</span></div>
                        <div class="flex items-center gap-3"><i data-lucide="check-circle-2"
                                class="text-amber-600 w-5 h-5"></i><span
                                class="font-bold text-slate-800">Sustentabilidade</span></div>
                        <div class="flex items-center gap-3"><i data-lucide="check-circle-2"
                                class="text-amber-600 w-5 h-5"></i><span class="font-bold text-slate-800">Segurança
                                Rigorosa</span></div>
                    </div>


                </div>
            </div>
        </div>
    </section>

    <!-- Services -->
    <section id="servicos" class="py-24 bg-slate-50">
        <div class="container mx-auto px-6">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <h2 class="text-amber-600 font-bold uppercase tracking-widest mb-4">Serviços</h2>
                <h3 class="text-4xl font-serif text-slate-900 mb-6">Soluções integradas para projetos complexos.</h3>
                <div class="w-20 h-1.5 bg-amber-600 mx-auto rounded-full"></div>
            </div>
            <div class="grid md:grid-cols-3 gap-8">
                <div
                    class="bg-white p-10 rounded-2xl shadow-sm hover:shadow-xl transition-all group border-b-4 border-transparent hover:border-amber-600">
                    <div class="w-16 h-16 bg-amber-50 rounded-2xl flex items-center justify-center text-amber-600 mb-8">
                        <i data-lucide="home" class="w-8 h-8"></i></div>
                    <h4 class="text-2xl font-bold text-slate-900 mb-4">Residencial Premium</h4>
                    <p class="text-slate-600">Casas de luxo com alto padrão de acabamento e gestão completa.</p>
                </div>
                <div
                    class="bg-white p-10 rounded-2xl shadow-sm hover:shadow-xl transition-all group border-b-4 border-transparent hover:border-amber-600">
                    <div class="w-16 h-16 bg-amber-50 rounded-2xl flex items-center justify-center text-amber-600 mb-8">
                        <i data-lucide="building-2" class="w-8 h-8"></i></div>
                    <h4 class="text-2xl font-bold text-slate-900 mb-4">Obras Corporativas</h4>
                    <p class="text-slate-600">Espaços empresariais focados em funcionalidade e prazos ágeis.</p>
                </div>
                <div
                    class="bg-white p-10 rounded-2xl shadow-sm hover:shadow-xl transition-all group border-b-4 border-transparent hover:border-amber-600">
                    <div class="w-16 h-16 bg-amber-50 rounded-2xl flex items-center justify-center text-amber-600 mb-8">
                        <i data-lucide="leaf" class="w-8 h-8"></i></div>
                    <h4 class="text-2xl font-bold text-slate-900 mb-4">Sustentabilidade</h4>
                    <p class="text-slate-600">Certificações verdes, energia solar e reuso de água.</p>
                </div>
            </div>
        </div>
    </section>


    <!-- Projects -->
    <section id="projetos" class="py-24 bg-white">
        <div class="container mx-auto px-6">
            <h2 class="text-amber-600 font-bold uppercase tracking-widest mb-4 text-center">Portfólio</h2>
            <h3 class="text-5xl font-serif text-slate-900 text-center mb-16">Obras que redefinem horizontes.</h3>
            <div class="grid md:grid-cols-3 gap-10">
                <div class="group relative rounded-3xl overflow-hidden shadow-2xl h-[450px]">
                    <img src="https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&q=80&w=800"
                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent"></div>
                    <div class="absolute bottom-0 p-8">
                        <h4 class="text-white text-2xl font-serif">Residência Skyline</h4>
                        <p class="text-amber-500 text-sm">São Paulo, SP</p>
                    </div>
                </div>
                <div class="group relative rounded-3xl overflow-hidden shadow-2xl h-[450px]">
                    <img src="https://images.unsplash.com/photo-1497366216548-37526070297c?auto=format&fit=crop&q=80&w=800"
                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent"></div>
                    <div class="absolute bottom-0 p-8">
                        <h4 class="text-white text-2xl font-serif">Elite Business Center</h4>
                        <p class="text-amber-500 text-sm">Curitiba, PR</p>
                    </div>
                </div>
                <div class="group relative rounded-3xl overflow-hidden shadow-2xl h-[450px]">
                    <img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&q=80&w=800"
                        class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                    <div class="absolute inset-0 bg-gradient-to-t from-slate-900 via-transparent"></div>
                    <div class="absolute bottom-0 p-8">
                        <h4 class="text-white text-2xl font-serif">Villa Ocean Breeze</h4>
                        <p class="text-amber-500 text-sm">Rio de Janeiro, RJ</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Contact Form -->
    <section id="contato" class="py-24 bg-slate-900">
        <div class="container mx-auto px-6 grid lg:grid-cols-2 gap-24 items-center">
            <div class="text-white">
                <h2 class="text-amber-500 font-bold uppercase tracking-widest mb-4">Contato</h2>
                <h3 class="text-5xl font-serif mb-8">Vamos construir o futuro juntos?</h3>
                <div class="space-y-6">
                    <div class="flex items-center gap-4"><i data-lucide="phone" class="text-amber-500"></i><span>(11)
                            4002-8922</span></div>
                    <div class="flex items-center gap-4"><i data-lucide="mail"
                            class="text-amber-500"></i><span>contato@elite-const.ai</span></div>
                    <div class="flex items-center gap-4"><i data-lucide="map-pin" class="text-amber-500"></i><span>Av.
                            Paulista, 1000 - SP</span></div>
                </div>
            </div>
            <div class="bg-white p-12 rounded-3xl shadow-2xl">
                <form class="space-y-6">
                    <input type="text" placeholder="Nome"
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-amber-600 transition-all">
                    <input type="email" placeholder="E-mail"
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-amber-600 transition-all">
                    <textarea rows="4" placeholder="Mensagem"
                        class="w-full bg-slate-50 border border-slate-200 rounded-xl px-4 py-3 outline-none focus:border-amber-600 transition-all"></textarea>
                    <button
                        class="w-full bg-amber-600 text-white font-bold py-4 rounded-xl shadow-xl hover:bg-amber-700 transition-all">Enviar</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-slate-950 py-12 text-slate-500 text-center border-t border-slate-900">
        <p>&copy; 2026 Elite Construction S.A. Todos os direitos reservados.</p>
    </footer>

    <!-- Floating Chat Component -->
    <div id="ai-chat" class="fixed bottom-6 right-6 z-[100]">
        <button id="chat-toggle"
            class="bg-amber-600 hover:bg-amber-700 text-white p-4 rounded-full shadow-2xl transition-all flex items-center justify-center">
            <i data-lucide="message-square" class="w-6 h-6"></i>
        </button>
        <div id="chat-window"
            class="hidden absolute bottom-20 right-0 w-[350px] h-[500px] bg-white rounded-2xl shadow-2xl flex flex-col overflow-hidden border border-slate-200">
            <div class="bg-slate-900 p-4 text-white flex justify-between items-center">
                <div class="flex items-center gap-2"><i data-lucide="bot" class="text-amber-500"></i><span
                        class="font-bold">Consultor Elite</span></div>
                <button onclick="document.getElementById('chat-window').classList.add('hidden')"><i data-lucide="x"
                        class="w-5 h-5"></i></button>
            </div>
            <div id="chat-history" class="chat-container flex-1 p-4 overflow-y-auto space-y-4 bg-slate-50 text-sm">
                <div class="flex justify-start">
                    <div class="bg-white p-3 rounded-2xl shadow-sm border border-slate-100 rounded-tl-none">Olá! Sou seu
                        Consultor Elite. Como posso ajudar com sua obra hoje?</div>
                </div>
            </div>
            <form id="chat-form" class="p-4 bg-white border-t flex gap-2">
                <input id="chat-input" type="text" placeholder="Digite sua dúvida..."
                    class="flex-1 bg-slate-100 border-none rounded-lg px-4 py-2 text-sm outline-none focus:ring-2 focus:ring-amber-500">
                <button type="submit" class="bg-amber-600 text-white p-2 rounded-lg"><i data-lucide="send"
                        class="w-4 h-4"></i></button>
            </form>
        </div>
    </div>

    <!-- AI Logic Script -->
    <script type="module">
        import { GoogleGenAI, Modality } from "@google/genai";

        // Initialize Lucide Icons
        lucide.createIcons();

        // Header Scroll Logic
        window.addEventListener('scroll', () => {
            const header = document.getElementById('header');
            if (window.scrollY > 50) {
                header.classList.add('glass-header', 'py-4', 'shadow-lg');
                header.classList.remove('py-6', 'bg-transparent');
            } else {
                header.classList.remove('glass-header', 'py-4', 'shadow-lg');
                header.classList.add('py-6', 'bg-transparent');
            }
        });

        // Mobile Menu Toggle
        window.toggleMobileMenu = (open) => {
            document.getElementById('mobile-menu').classList.toggle('hidden', !open);
            document.getElementById('mobile-menu').classList.toggle('flex', open);
        };

        // --- GEMINI AI IMPLEMENTATION ---

        const apiKey = process.env.API_KEY;

        // 1. Consultant Chat
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatHistory = document.getElementById('chat-history');
        const chatToggle = document.getElementById('chat-toggle');
        const chatWindow = document.getElementById('chat-window');

        chatToggle.onclick = () => chatWindow.classList.toggle('hidden');

        chatForm.onsubmit = async (e) => {
            e.preventDefault();
            const text = chatInput.value.trim();
            if (!text) return;

            // Add user message
            addMessage('user', text);
            chatInput.value = '';

            try {
                const ai = new GoogleGenAI({ apiKey });
                const response = await ai.models.generateContent({
                    model: 'gemini-3-flash-preview',
                    contents: text,
                    config: {
                        systemInstruction: 'Você é um consultor sênior de engenharia da Construtora Elite. Seja profissional, técnico e educado. Fale sempre em Português.'
                    }
                });
                addMessage('model', response.text);
            } catch (err) {
                console.error(err);
                addMessage('model', 'Erro ao processar. Verifique sua conexão.');
            }
        };

        function addMessage(role, text) {
            const div = document.createElement('div');
            div.className = `flex ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `<div class="max-w-[80%] p-3 rounded-2xl ${role === 'user' ? 'bg-amber-600 text-white rounded-tr-none' : 'bg-white text-slate-800 shadow-sm border border-slate-100 rounded-tl-none'}">${text}</div>`;
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        // 2. Concept Image Generator
        const genBtn = document.getElementById('generate-btn');
        const conceptInput = document.getElementById('concept-prompt');
        const conceptResult = document.getElementById('concept-result');
        const conceptLoader = document.getElementById('concept-loader');
        const conceptPlaceholder = document.getElementById('concept-placeholder');

        genBtn.onclick = async () => {
            const prompt = conceptInput.value.trim();
            if (!prompt) return;

            conceptLoader.classList.remove('hidden');
            conceptPlaceholder.classList.add('hidden');
            conceptResult.classList.add('hidden');

            try {
                const ai = new GoogleGenAI({ apiKey });
                const fullPrompt = `Architectural concept for ${prompt}, luxury construction, high-end, 8k, modern, cinematic lighting.`;
                const response = await ai.models.generateContent({
                    model: 'gemini-2.5-flash-image',
                    contents: { parts: [{ text: fullPrompt }] },
                    config: { imageConfig: { aspectRatio: "16:9" } }
                });

                const imgPart = response.candidates?.[0]?.content?.parts.find(p => p.inlineData);
                if (imgPart) {
                    conceptResult.src = `data:image/png;base64,${imgPart.inlineData.data}`;
                    conceptResult.classList.remove('hidden');
                }
            } catch (err) {
                console.error(err);
                alert("Erro ao gerar imagem.");
                conceptPlaceholder.classList.remove('hidden');
            } finally {
                conceptLoader.classList.add('hidden');
            }
        };

        // 3. Voice Assistant (Live API)
        let isVoiceActive = false;
        let session = null;
        let audioContext = null;
        let sources = new Set();
        let nextStartTime = 0;

        const voiceBtn = document.getElementById('voice-btn');
        const voiceIcon = document.getElementById('voice-icon');

        async function decodeAudioData(data, ctx) {
            const dataInt16 = new Int16Array(data.buffer);
            const buffer = ctx.createBuffer(1, dataInt16.length, 24000);
            const channelData = buffer.getChannelData(0);
            for (let i = 0; i < dataInt16.length; i++) {
                channelData[i] = dataInt16[i] / 32768.0;
            }
            return buffer;
        }

        function encode(bytes) {
            let binary = '';
            for (let i = 0; i < bytes.byteLength; i++) binary += String.fromCharCode(bytes[i]);
            return btoa(binary);
        }

        function decode(base64) {
            const binary = atob(base64);
            const bytes = new Uint8Array(binary.length);
            for (let i = 0; i < binary.length; i++) bytes[i] = binary.charCodeAt(i);
            return bytes;
        }

        voiceBtn.onclick = async () => {
            if (isVoiceActive) {
                stopVoice();
                return;
            }

            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                isVoiceActive = true;
                voiceBtn.querySelector('span').innerText = 'Encerrar';
                voiceBtn.classList.replace('bg-slate-900', 'bg-red-600');
                voiceIcon.classList.add('animate-pulse');

                audioContext = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 24000 });
                const inputCtx = new (window.AudioContext || window.webkitAudioContext)({ sampleRate: 16000 });

                const ai = new GoogleGenAI({ apiKey });
                const sessionPromise = ai.live.connect({
                    model: 'gemini-2.5-flash-native-audio-preview-12-2025',
                    callbacks: {
                        onopen: () => {
                            const source = inputCtx.createMediaStreamSource(stream);
                            const scriptProcessor = inputCtx.createScriptProcessor(4096, 1, 1);
                            scriptProcessor.onaudioprocess = (e) => {
                                if (!isVoiceActive) return;
                                const inputData = e.inputBuffer.getChannelData(0);
                                const int16 = new Int16Array(inputData.length);
                                for (let i = 0; i < inputData.length; i++) int16[i] = inputData[i] * 32768;
                                sessionPromise.then(s => s.sendRealtimeInput({
                                    media: { data: encode(new Uint8Array(int16.buffer)), mimeType: 'audio/pcm;rate=16000' }
                                }));
                            };
                            source.connect(scriptProcessor);
                            scriptProcessor.connect(inputCtx.destination);
                        },
                        onmessage: async (msg) => {
                            const b64 = msg.serverContent?.modelTurn?.parts[0]?.inlineData?.data;
                            if (b64 && audioContext) {
                                const buffer = await decodeAudioData(decode(b64), audioContext);
                                const source = audioContext.createBufferSource();
                                source.buffer = buffer;
                                source.connect(audioContext.destination);
                                const start = Math.max(nextStartTime, audioContext.currentTime);
                                source.start(start);
                                nextStartTime = start + buffer.duration;
                                sources.add(source);
                                source.onended = () => sources.delete(source);
                            }
                        }
                    },
                    config: {
                        responseModalities: [Modality.AUDIO],
                        speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: 'Kore' } } },
                        systemInstruction: 'Você é o Gerente de Obras Elite. Fale sobre engenharia de luxo e prazos com entusiasmo. Seja breve.'
                    }
                });
                session = await sessionPromise;
            } catch (err) {
                console.error(err);
                stopVoice();
            }
        };

        function stopVoice() {
            isVoiceActive = false;
            if (session) session.close();
            sources.forEach(s => s.stop());
            sources.clear();
            voiceBtn.querySelector('span').innerText = 'Conversar';
            voiceBtn.classList.replace('bg-red-600', 'bg-slate-900');
            voiceIcon.classList.remove('animate-pulse');
            nextStartTime = 0;
        }
    </script>
</body>

</html>